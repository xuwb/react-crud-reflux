"use strict";define(function(e,t,a){var l=e("react"),n=e("../common/util"),i=e("./crudBtn"),s=e("./dataRow"),c=e("./infoBox"),r=l.createClass({displayName:"DataTable",getInitialState:function(){return{elemTrs:null,articalId:0,infoBtnType:"add",infoStyle:{display:"none"}}},addHandler:function(e){e.preventDefault(),e.stopPropagation(),console.log("onClick add"),this.setState({infoBtnType:"add",infoStyle:{display:"block"}})},onModifyClick:function(e){console.log("modify-callback:"+e),this.refs.infoBox.setState({id:e.id,title:e.title,author:e.author}),this.setState({infoBtnType:"modify",infoStyle:{display:"block"}})},onDeleteClick:function(e){var t,a=this.state.elemTrs;for(t in a)if(a[t].key==e.id)break;a.splice(t,1),this.setState({elemTrs:a})},onInfoClick:function(e,t){var a=this.state.elemTrs,l=++this.state.articalId,n=this.state.infoBtnType;if(t&&("add"==n&&(this.setState({articalId:l}),t.id=l,a.push(this.createRow(t))),"modify"==n)){var i;for(i in a)if(a[i].key==t.id)break;a.splice(i,1,this.createRow(t))}this.setState({elemTrs:a,infoStyle:{display:e}})},onTableBtnClick:function(e){e=e?e:this.state.elemTrs,self.setState({elemTrs:e})},render:function(){return l.createElement("div",{className:"container"},l.createElement("div",{className:"col-top"},l.createElement("h1",{className:"col-title"},"增删改DEMO"),l.createElement("a",{className:"btn btn-add",href:"#",onClick:this.addHandler},"添加")),l.createElement("div",{className:"col-info",style:this.state.infoStyle},l.createElement(c,{ref:"infoBox",callbackParent:this.onInfoClick,articalId:this.state.articalId})),l.createElement("table",{className:"col-table",ref:"tableList"},l.createElement("thead",null,l.createElement("tr",null,l.createElement("td",{width:"100"},"标题"),l.createElement("td",{width:"80"},"作者"),l.createElement("td",{width:"150"},"发布时间"),l.createElement("td",{width:"150"},"操作"))),l.createElement("tbody",null,this.state.elemTrs)))},componentDidMount:function(){var e=this;$.ajax({type:"get",url:this.props.source,success:function(t){var a=[];t.forEach(function(t){e.setState({articalId:parseInt(t.id)}),a.push(e.createRow(t))}),e.setState({elemTrs:a})}})},createRow:function(e){return l.createElement(s,{key:e.id},l.createElement("span",null,e.title),l.createElement("span",null,e.author),l.createElement("span",null,n.formatDateTime(e.pubtime)),l.createElement("span",null,l.createElement(i,{btnName:"修改",data:e,callbackParent:this.onModifyClick})," ",l.createElement(i,{btnName:"删除",data:e,callbackParent:this.onDeleteClick})))}});a.exports=r});